var socket=io.connect(window.location.href),app=app||{};$(function(){var $blastField=$("#blast"),$allPostsTextArea=$("#allPosts"),$clearAllPosts=$("#clearAllPosts"),$sendBlastButton=$("#send"),$imageField=$("#image"),$audioField=$("#audio");socket.on("blast",function(data){var copy=$allPostsTextArea.html();$allPostsTextArea.html("<p>"+copy+data.msg+"</p>"),$allPostsTextArea.scrollTop($allPostsTextArea[0].scrollHeight-$allPostsTextArea.height())}),socket.on("boom",function(data){var copy=$allPostsTextArea.html();$allPostsTextArea.html("<p>"+copy+'<img src="'+data.msg+'"/></p>'),$allPostsTextArea.scrollTop($allPostsTextArea[0].scrollHeight-$allPostsTextArea.height())}),socket.on("bow",function(data){var copy=$allPostsTextArea.html();$allPostsTextArea.html("<p>"+copy+'<audio src="'+data.msg+'" controls></audio></p>"'),$allPostsTextArea.scrollTop($allPostsTextArea[0].scrollHeight-$allPostsTextArea.height())}),$clearAllPosts.click(function(){$allPostsTextArea.text("")}),$sendBlastButton.click(function(){var blast=$blastField.val();blast.length&&socket.emit("blast",{msg:blast},function(){$blastField.val("")})}),$imageField.change(function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var file=e.target.files[0],reader=new FileReader;reader.onload=function(){var image=this.result;image.length&&socket.emit("boom",{image:image},function(){$imageField.val("")})},reader.onProgress=function(){console.log(this.progress)},reader.readAsDataURL(file)}else alert("The File APIs are not fully supported by your browser.")}),$audioField.change(function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var file=e.target.files[0],reader=new FileReader;reader.onload=function(){var audio=this.result;audio.length&&socket.emit("bow",{audio:audio},function(){$audioField.val("")})},reader.onProgress=function(){console.log(this.progress)},reader.readAsDataURL(file)}else alert("The File APIs are not fully supported by your browser.")}),$blastField.keydown(function(e){13==e.keyCode&&$sendBlastButton.trigger("click")})});